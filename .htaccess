# 404エラーページの設定
ErrorDocument 404 /404.html

# URLリライト設定
RewriteEngine On

# 拡張子付きURLを拡張子なしにリダイレクト（ブラウザのURL表示を変更）
RewriteCond %{THE_REQUEST} \s/+(.+)\.html[\s?] [NC]
RewriteRule ^ /%1? [R=301,L]

RewriteCond %{THE_REQUEST} \s/+(.+)\.php[\s?] [NC]
RewriteRule ^ /%1? [R=301,L]

RewriteCond %{THE_REQUEST} \s/+(.+)\.txt[\s?] [NC]
RewriteRule ^ /%1? [R=301,L]

# 拡張子付きでも拡張子なしでも同じファイルを表示（内部リライト）
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.html -f
RewriteRule ^([^\.]+)$ $1.html [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^([^\.]+)$ $1.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.txt -f
RewriteRule ^([^\.]+)$ $1.txt [L]

# 存在しないファイルやディレクトリへのアクセスを404にリダイレクト
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /404.html [L,R=302]

# セキュリティ設定
Options -Indexes

# キャッシュ設定
<IfModule mod_expires.c>
    ExpiresActive On
    # CSS、JS、JSONは毎回読み込み（キャッシュしない）
    ExpiresByType text/css "access plus 0 seconds"
    ExpiresByType application/javascript "access plus 0 seconds"
    ExpiresByType application/json "access plus 0 seconds"
    ExpiresByType text/json "access plus 0 seconds"
    # 画像は1時間キャッシュ
    ExpiresByType image/png "access plus 1 hour"
    ExpiresByType image/jpg "access plus 1 hour"
    ExpiresByType image/jpeg "access plus 1 hour"
    ExpiresByType image/gif "access plus 1 hour"
    ExpiresByType image/svg+xml "access plus 1 hour"
</IfModule>

# ヘッダー設定でキャッシュを制御
<IfModule mod_headers.c>
    # CSS、JS、JSONファイルはキャッシュしない
    <FilesMatch "\.(css|js|json)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</IfModule>